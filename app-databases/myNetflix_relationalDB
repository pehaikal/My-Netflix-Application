-- rollback script
drop table if exists billing_address, contact_role, role_details, seen_movie, movie, login, contact;

-- rollout script
create table contact( 
	contact_id serial not null constraint contact_id_pk primary key,
	first_name varchar(80) not null,
	last_name varchar(80) not null,
	phone_number varchar(30) not null,
	email_address varchar(80) not null constraint contact_email_address_unique unique
);

create table login(
	contact_id integer not null references contact (contact_id) constraint login_contact_id_unique unique,
	login_password varchar(64) not null
);

create table movie(
	movie_id serial not null constraint movie_id_pk primary key,
	title varchar(255) not null,
	author varchar(100) not null,
	movie_type varchar(80) not null,
	description varchar(255) null,
	release_date Date not null
);

create table seen_movie(
	movie_id integer not null references movie (movie_id),
	contact_id integer not null references contact (contact_id),
	watched_date Date not null,
	UNIQUE (movie_id, contact_id)
);

create table role_details(
	role_name varchar(60) not null constraint role_name_pk primary key
);

create table contact_role(
	contact_id integer not null references contact (contact_id),
	role_name varchar(60) not null references role_details (role_name)
);

create table billing_address(
	billing_address_id serial not null constraint billing_address_id_pk primary key,
	contact_id integer not null references contact (contact_id),
	country varchar(40) not null,
	area varchar(30) not null,
	street varchar(45) not null,
	street_number int not null
);

-- data
INSERT INTO contact (contact_id, first_name, last_name, phone_number, email_address) VALUES (default, 'pierre', 'haikal', '05555555', 'pierre@mail.com');
INSERT INTO login(contact_id, login_password) VALUES ((select contact_id from contact where email_address = 'pierre@mail.com'), '3CE9E23F4E5FBEA65452957F19083014648C4FA4CE8A1C091DCFAADB72330539');
INSERT INTO movie (movie_id, title, author, movie_type, release_date) VALUES (default, 'the matrix', 'carl', 'sci-fi', '1985-05-07');
INSERT INTO seen_movie (movie_id, contact_id, watched_date) VALUES ((select movie_id from movie where title = 'the matrix'), (select contact_id from contact where email_address = 'pierre@mail.com'), '2022-06-28');
INSERT INTO role_details (role_name) VALUES ('manager');
INSERT INTO contact_role (contact_id, role_name) VALUES ((select contact_id from contact where email_address = 'pierre@mail.com'), 'manager');
INSERT INTO billing_address (billing_address_id, contact_id, country, area, street, street_number) VALUES (default, (select contact_id from contact where email_address = 'pierre@mail.com'), 'france', 'vitry-sur-seine', 'rue talma', '30');


INSERT INTO contact (contact_id, first_name, last_name, phone_number, email_address) VALUES (default, 'nathalie', 'hayek', '0662525721', 'nathalie123@mail.com');
INSERT INTO login(contact_id, login_password) VALUES ((select contact_id from contact where email_address = 'nathalie123@mail.com'), 'bb234db7ffce39a2222066ef706e486628452a964442f620b2254e3bdb614f91');
INSERT INTO movie (movie_id, title, author, movie_type, release_date) VALUES (default, 'superman vs batman: dawn of justice', 'Chris Terrio', 'action-adventure', '2016-02-25');
INSERT INTO seen_movie (movie_id, contact_id, watched_date) VALUES ((select movie_id from movie where title = 'superman vs batman: dawn of justice'), (select contact_id from contact where email_address = 'nathalie123@mail.com'), '2020-07-29');
INSERT INTO role_details (role_name) VALUES ('member');
INSERT INTO contact_role (contact_id, role_name) VALUES ((select contact_id from contact where email_address = 'nathalie123@mail.com'), 'member');
INSERT INTO billing_address (billing_address_id, contact_id, country, area, street, street_number) VALUES (default, (select contact_id from contact where email_address = 'nathalie123@mail.com'), 'france', 'villejuif', 'rue de gentilly', '04');